<div class="forgot-password-container">
  <!-- Stepper Visual -->
   <!-- Atualizar o stepper para uma versão mais nova -->
  <!-- <div class="stepper-container">
    <mat-stepper [selectedIndex]="currentStep - 1" [linear]="true" #stepper class="visual-stepper">
      <mat-step [completed]="emailSent">
        <ng-template matStepLabel>Informar Email</ng-template>
      </mat-step>
      <mat-step [completed]="codeValidated">
        <ng-template matStepLabel>Validar Código</ng-template>
      </mat-step>
      <mat-step [completed]="passwordChanged">
        <ng-template matStepLabel>Nova Senha</ng-template>
      </mat-step>
    </mat-stepper>
  </div> -->

  <!-- Container para centralizar o card -->
  <div class="content-container">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Redefinir Senha</mat-card-title>
        <mat-card-subtitle>
          <span *ngIf="currentStep === 1">Etapa 1 de 3: Informe seu email</span>
          <span *ngIf="currentStep === 2">Etapa 2 de 3: Digite o código recebido</span>
          <span *ngIf="currentStep === 3">Etapa 3 de 3: Defina sua nova senha</span>
        </mat-card-subtitle>
      </mat-card-header>

    <mat-card-content>
      <!-- Etapa 1: Email -->
      <div *ngIf="currentStep === 1" class="step-content">
        <p class="step-description">
          Digite seu email cadastrado. Enviaremos um código de verificação para redefinir sua senha.
        </p>

        <form [formGroup]="emailForm" (ngSubmit)="sendResetCode()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" placeholder="seu@email.com">
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="emailForm.get('email')?.hasError('required')">
              Email é obrigatório
            </mat-error>
            <mat-error *ngIf="emailForm.get('email')?.hasError('email')">
              Formato de email inválido
            </mat-error>
          </mat-form-field>

          <div class="form-actions">
            <button mat-button type="button" (click)="goToLogin()" [disabled]="loading">
              Voltar ao Login
            </button>
            <button mat-raised-button color="primary" type="submit"
                    [disabled]="emailForm.invalid || loading">
              <span *ngIf="!loading">Enviar Código</span>
              <span *ngIf="loading">Enviando...</span>
            </button>
          </div>
        </form>
      </div>

      <!-- Etapa 2: Código -->
      <div *ngIf="currentStep === 2" class="step-content">
        <p class="step-description">
          Um código de verificação foi enviado para <strong>{{ userEmail }}</strong>.
          Digite o código recebido no campo abaixo.
        </p>

        <form [formGroup]="codeForm" (ngSubmit)="validateCode()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Código de Verificação</mat-label>
            <input matInput formControlName="code" placeholder="Ex: E9EE0"
                   maxlength="5" class="code-input">
            <mat-icon matSuffix>verified_user</mat-icon>
            <mat-error *ngIf="codeForm.get('code')?.hasError('required')">
              Código é obrigatório
            </mat-error>
            <mat-error *ngIf="codeForm.get('code')?.hasError('minlength') || codeForm.get('code')?.hasError('maxlength')">
              Código deve ter 5 caracteres
            </mat-error>
          </mat-form-field>

          <div class="form-actions">
            <button mat-button type="button" (click)="goBack()" [disabled]="loading">
              Voltar
            </button>
            <button mat-raised-button color="primary" type="submit"
                    [disabled]="codeForm.invalid || loading">
              <span *ngIf="!loading">Validar Código</span>
              <span *ngIf="loading">Validando...</span>
            </button>
          </div>
        </form>
      </div>

      <!-- Etapa 3: Nova Senha -->
      <div *ngIf="currentStep === 3" class="step-content">
        <p class="step-description">
          Código validado com sucesso! Agora defina sua nova senha.
        </p>

        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nova Senha</mat-label>
            <input matInput formControlName="newPassword"
                   [type]="hidePassword ? 'password' : 'text'"
                   placeholder="Sua nova senha">
            <button mat-icon-button matSuffix
                    (click)="hidePassword = !hidePassword"
                    type="button">
              <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
              Nova senha é obrigatória
            </mat-error>
            <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
              Senha deve ter pelo menos 6 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirmar Nova Senha</mat-label>
            <input matInput formControlName="confirmPassword"
                   [type]="hideConfirmPassword ? 'password' : 'text'"
                   placeholder="Confirme sua nova senha">
            <button mat-icon-button matSuffix
                    (click)="hideConfirmPassword = !hideConfirmPassword"
                    type="button">
              <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">
              Confirmação de senha é obrigatória
            </mat-error>
            <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('passwordMismatch')">
              Senhas não coincidem
            </mat-error>
          </mat-form-field>

          <div class="form-actions">
            <button mat-button type="button" (click)="goBack()" [disabled]="loading">
              Voltar
            </button>
            <button mat-raised-button color="primary" type="submit"
                    [disabled]="passwordForm.invalid || loading">
              <span *ngIf="!loading">Alterar Senha</span>
              <span *ngIf="loading">Alterando...</span>
            </button>
          </div>
        </form>
      </div>
    </mat-card-content>
  </mat-card>
  </div> <!-- Fechar content-container -->
</div> <!-- Fechar forgot-password-container -->
